var self;export default class rouletteWheel{wheel;colors=[];centerX;centerY;outerThinGrayCircleRadius=0;outerBoldWhiteCircleRadius=0;outerThinGrayCircleThickness=0;outerBoldWhiteCircleThickness=0;outerThinWhiteCircleThickness=0;centreWhiteBallRadius=0;outerThinWhiteCircleRadius=0;centreOrangeBallRadius=0;innerThinOrangeCircleRadius=0;centreThinWhiteCircleRadius=0;segmentBallRadius=0;allImageLoaded=!1;pointerPadding=0;randomizeWin;onAnimationStop;currentDrawAngle=0;option=null;spinDirection={clockwise:1,antiClockwise:-1};wheelContext;colorObject={loginOrange:"#dc6818",rouletteYellow:"#FCA511",rouletteOrange:"#F54E1E",rouletteOuterWhite:"#ffff",rouletteGray:"#8E7F7F",rouletteBlue:"#0996F2",rouletteGreen:"#1AEB8F"};constructor(_option){this._initializeOption(_option),this.easeFunction=this._getEaseFunction(this.option.animation.easing)}initializeWheel(){this._refineSpinRewards(),this.randomizeWin=void 0===this.option.winSegment,this.wheel=document.getElementById(this.option.canvasId),this.wheel.addEventListener("touchstart",this._onTouchStart,!1),this.wheel.addEventListener("touchmove",this._onTouchMove,!1),this.wheel.addEventListener("touchend",this._onTouchEnd,!1),this.centerX=this.wheel.width/2,this.centerY=this.wheel.height/2,this.wheelContext=this.wheel.getContext("2d"),this._configureSizes(),this._drawRoulette(0),this._loadWheelImages()}_drawRoulette(drawAngle){drawAngle+=this.currentDrawAngle,this._clearCanvas(),this.wheelContext.save(),this._rotateCanvas(drawAngle),this._drawOuterGrayCircle(),this._drawOuterWhiteCircle(),this._drawSegments(),this._drawOuterThinWhiteCircle(),this._drawCentreWhiteBall(),this._drawCentreOrangeBall(),this._drawCentreThinWhiteCircle(),this._drawInnerThinOrangeCircle(),this.wheelContext.restore(),this._drawPointer()}_initializeOption(_option){_option=_option||{},this.option={spinRewards:_option.spinRewards,drawText:void 0===_option.drawText||_option.drawText,drawImage:void 0===_option.drawImage||_option.drawImage,winSegment:_option.winSegment,canvasId:_option.canvasId?_option.canvasId:"canvas",pointer:this._getInitializedPointer(_option.pointer),spinDirection:this._resolveSpinDirection(_option.spinDirection),animation:this._getInitializedAnimation(_option.animation),outerThinGrayCircleColor:_option.outerThinGrayCircleColor?_option.outerThinGrayCircleColor:this.colorObject.rouletteGray,outerBoldWhiteCircleColor:_option.outerBoldWhiteCircleColor?_option.outerBoldWhiteCircleColor:this.colorObject.rouletteOuterWhite,outerThinWhiteCircleColor:_option.outerThinWhiteCircleColor?_option.outerThinWhiteCircleColor:this.colorObject.rouletteOuterWhite,centreWhiteBallColor:_option.centreWhiteBallColor?_option.centreWhiteBallColor:this.colorObject.rouletteOuterWhite,centreOrangeBallColor:_option.centreOrangeBallColor?_option.centreOrangeBallColor:this.colorObject.loginOrange,innerThinOrangeCircleColor:_option.innerThinOrangeCircleColor?_option.innerThinOrangeCircleColor:this.colorObject.loginOrange,centreThinWhiteCircleColor:_option.centreThinWhiteCircleColor?_option.centreThinWhiteCircleColor:this.colorObject.rouletteOuterWhite,segmentBallColor:_option.segmentBallColor?_option.segmentBallColor:this.colorObject.rouletteOuterWhite,segmentLineColor:_option.segmentLineColor?_option.segmentLineColor:this.colorObject.rouletteOuterWhite}}_resolveSpinDirection(_stringDirection){return"anti-clockwise"===(_stringDirection=_stringDirection?_stringDirection.trim().toLowerCase():_stringDirection)?this.spinDirection.antiClockwise:this.spinDirection.clockwise}_getInitializedPointer(_pointer){var pointer;return{image:(_pointer=_pointer||{}).image?_pointer.image:null,degree:void 0===_pointer.degree?270:_pointer.degree}}_getInitializedAnimation(_animation){var animation;return{duration:"infinite"==(_animation=_animation||{}).duration?5e3:_animation.duration,easing:void 0===_animation.easing?"easeInOut":_animation.easing,isInfiniteDuration:"infinite"==_animation.duration,rotationPerSecond:void 0===_animation.rotationPerSecond?360:_animation.rotationPerSecond}}_refineSpinRewards(){var totalDegree=0;this.option.spinRewards.forEach(reward=>totalDegree+=reward.degree),this.option.spinRewards.forEach((reward,index)=>{0==this.colors.length&&(this.colors=[this.colorObject.loginOrange,this.colorObject.rouletteYellow,this.colorObject.rouletteGray,this.colorObject.rouletteOrange,this.colorObject.rouletteBlue,this.colorObject.rouletteGreen]),reward.winSegment&&(this.option.winSegment=index);var colorIndex=Math.floor(Math.random()*this.colors.length);reward.fillStyle=reward.fillStyle?reward.fillStyle:this.colors[colorIndex],reward.degree=reward.degree/totalDegree*360,this.colors.splice(colorIndex,1)})}_loadWheelImages(){this.option.drawImage&&this.option.spinRewards.forEach(reward=>{reward.image&&this._preloadImage(reward.image,img=>{reward.imageData=img,this._tryDrawImageWheel()})})}_tryDrawImageWheel(){this.allImageLoaded=this.option.spinRewards.every(sr=>sr.imageData),this.allImageLoaded&&this.option.drawImage&&this._drawRoulette(0)}_configureSizes(){this.outerThinGrayCircleThickness=.5,this.outerBoldWhiteCircleThickness=this.wheel.width/20,this.outerThinWhiteCircleThickness=1,this.outerThinGrayCircleRadius=this.centerX-this.pointerPadding;var distanceAwayFromOuterWhite=this.wheel.width/25;this.outerThinWhiteCircleRadius=this.centerX-(this.outerThinGrayCircleThickness+this.outerBoldWhiteCircleThickness+distanceAwayFromOuterWhite+this.outerThinWhiteCircleThickness),this.outerBoldWhiteCircleRadius=this.outerThinGrayCircleRadius-(this.outerThinGrayCircleThickness+this.outerBoldWhiteCircleThickness/2),this.centreWhiteBallRadius=this.wheel.width/11,this.centreOrangeBallRadius=this.wheel.width/20,this.innerThinOrangeCircleRadius=this.wheel.width/14,this.centreThinWhiteCircleRadius=this.wheel.width/7,this.segmentBallRadius=this.wheel.width/75}_drawOuterGrayCircle(){this.wheelContext.beginPath();var startAngle=0,endAngle=this._degreeToRadian(360);this.wheelContext.arc(this.centerX,this.centerY,this.outerThinGrayCircleRadius,0,endAngle,!1),this.wheelContext.lineWidth=this.outerThinGrayCircleThickness,this.wheelContext.strokeStyle=this.option.outerThinGrayCircleColor,this.wheelContext.stroke()}_drawOuterWhiteCircle(){this.wheelContext.beginPath();var startAngle=0,endAngle=this._degreeToRadian(360);this.wheelContext.arc(this.centerX,this.centerY,this.outerBoldWhiteCircleRadius,0,endAngle,!1),this.wheelContext.lineWidth=this.outerBoldWhiteCircleThickness,this.wheelContext.strokeStyle=this.option.outerBoldWhiteCircleColor,this.wheelContext.stroke()}_drawOuterThinWhiteCircle(){this.wheelContext.beginPath();var startAngle=0,endAngle=this._degreeToRadian(360);this.wheelContext.arc(this.centerX,this.centerY,this.outerThinWhiteCircleRadius,0,endAngle,!1),this.wheelContext.lineWidth=this.outerThinWhiteCircleThickness,this.wheelContext.strokeStyle=this.option.outerThinWhiteCircleColor,this.wheelContext.stroke()}_drawCentreWhiteBall(){this.wheelContext.beginPath();var startAngle=0,endAngle=this._degreeToRadian(360);this.wheelContext.arc(this.centerX,this.centerY,this.centreWhiteBallRadius,0,endAngle,!1),this.wheelContext.fillStyle=this.option.centreWhiteBallColor,this.wheelContext.fill()}_drawInnerThinOrangeCircle(){this.wheelContext.beginPath();var startAngle=0,endAngle=this._degreeToRadian(360);this.wheelContext.arc(this.centerX,this.centerY,this.innerThinOrangeCircleRadius,0,endAngle,!1),this.wheelContext.lineWidth=this.wheel.width/300,this.wheelContext.strokeStyle=this.option.innerThinOrangeCircleColor,this.wheelContext.stroke()}_drawCentreOrangeBall(){this.wheelContext.beginPath();var startAngle=0,endAngle=this._degreeToRadian(360);this.wheelContext.arc(this.centerX,this.centerY,this.centreOrangeBallRadius,0,endAngle,!1),this.wheelContext.fillStyle=this.option.centreOrangeBallColor,this.wheelContext.fill()}_drawCentreThinWhiteCircle(){this.wheelContext.beginPath();var startAngle=0,endAngle=this._degreeToRadian(360);this.wheelContext.arc(this.centerX,this.centerY,this.centreThinWhiteCircleRadius,0,endAngle,!1),this.wheelContext.lineWidth=1,this.wheelContext.strokeStyle=this.option.centreThinWhiteCircleColor,this.wheelContext.stroke()}_drawSegmentBall(){this.wheelContext.beginPath(),this.wheelContext.moveTo(this.centerX,this.centerY);var startAngle=0,endAngle=this._degreeToRadian(360),centerX=this.centerX+this.outerThinWhiteCircleRadius-this.outerThinWhiteCircleThickness/2,centerY=this.centerY;this.wheelContext.arc(centerX,centerY,this.segmentBallRadius,0,endAngle,!1),this.wheelContext.fillStyle=this.option.segmentBallColor,this.wheelContext.fill()}_drawSegmentLine(){this.wheelContext.beginPath(),this.wheelContext.moveTo(this.centerX,this.centerY);var positionX=this.wheel.width-(this.outerThinGrayCircleThickness+this.outerBoldWhiteCircleThickness),positionY=this.centerY;this.wheelContext.lineTo(positionX,positionY),this.wheelContext.lineWidth=this.wheel.width/120,this.wheelContext.strokeStyle=this.option.segmentLineColor,this.wheelContext.stroke()}_drawPointer(){if(this.option.pointer&&this.option.pointer.image&&!this.option.pointer.imageData)this._preloadImage(this.option.pointer.image,img=>{this.option.pointer.imageData=img,this._drawPointer()});else if(this.option.pointer&&this.option.pointer.imageData){this.option.pointer.degree=void 0===this.option.pointer.degree?270:this.option.pointer.degree,this.option.pointer.degree=this.option.pointer.degree%360;var widthHeight=this._scaleImageToDimension(50,this.option.pointer.imageData),xCorner=this.centerX-widthHeight.width/2,yCorner=this.centerY-this.outerThinGrayCircleRadius;this.wheelContext.save();var trueDegree=this.option.pointer.degree+90;this._rotateCanvas(trueDegree*this.option.spinDirection),this.wheelContext.drawImage(this.option.pointer.imageData,xCorner,yCorner,widthHeight.width,widthHeight.height),this.wheelContext.restore()}}_scaleImageToDimension(dimensionToUse,image){var widthRatio=image.width/image.height,heightRatio=image.height/image.width,height=image.height>image.width?dimensionToUse:Math.round(heightRatio*dimensionToUse),width;return{width:image.width>image.height?dimensionToUse:Math.round(widthRatio*dimensionToUse),height:height}}_drawRewardImage(reward){if(this.allImageLoaded){var dimensionToUse=this.wheel.width<this.wheel.height?this.wheel.width:this.wheel.height,weight=reward.degree*this.option.spinRewards.length/360;dimensionToUse=dimensionToUse/this.option.spinRewards.length*weight;var widthHeight=this._scaleImageToDimension(dimensionToUse,reward.imageData),allowedWidth=widthHeight.width,allowedHeight,halfHeight=widthHeight.height/2,halfWidth=allowedWidth/2,xCorner=this.centerX+this.outerThinGrayCircleRadius/2-halfWidth,yCorner=this.centerY-halfHeight;this.wheelContext.drawImage(reward.imageData,xCorner,yCorner,widthHeight.width,widthHeight.height)}}_drawSegments(){var currentAngle=0;this.option.spinRewards.forEach(reward=>{this.wheelContext.beginPath(),this.wheelContext.moveTo(this.centerX,this.centerY);var radius=this.centerX-(this.outerThinGrayCircleThickness+this.outerBoldWhiteCircleThickness),startAngle=this._degreeToRadian(currentAngle);currentAngle+=reward.degree;var endAngle=this._degreeToRadian(currentAngle);this.wheelContext.arc(this.centerX,this.centerY,radius,startAngle,endAngle,!1),this.wheelContext.fillStyle=reward.fillStyle,this.wheelContext.fill(),this.wheelContext.save(),this._rotateCanvas(currentAngle-reward.degree,!0),this._drawSegmentLine(),this._drawSegmentBall(),this._rotateCanvas(reward.degree/2,!0),this._drawRewardImage(reward),this.wheelContext.restore()}),this._drawSegmentLine(),this._drawSegmentBall()}_degreeToRadian(degree){var radian;return Math.PI*degree/180}_rotateCanvas(degree,ensurePositive){!0!==ensurePositive&&(degree*=this.option.spinDirection),this.wheelContext.translate(this.centerX,this.centerY);var radian=this._degreeToRadian(degree);this.wheelContext.rotate(radian),this.wheelContext.translate(-this.centerX,-this.centerY)}_preloadImage(imageUrl,callback){if(imageUrl){var img=new Image;img.src=imageUrl,img.onload=()=>{callback(img)}}}_clearCanvas(){this.wheelContext.clearRect(0,0,this.wheel.width,this.wheel.height)}animationHandle;animationStartTimeInMilli;easeFunction;stopRotation;currentRotation;spinActive=!1;_getDurationRotation(durationInMilli){return this.option.animation.rotationPerSecond*(durationInMilli/1e3)}startAnimation(){this.spinActive||(this.spinActive=!0,this.easeFunction=this._getEaseFunction(this.option.animation.easing),this.stopRotation=this._getDurationRotation(this.option.animation.duration),this.stopRotation=this._adjustStopRotationToWinSegment(this.stopRotation),this.animationStartTimeInMilli=performance.now(),self=this,this.animationHandle=requestAnimationFrame(this.animate))}stopAnimation(){if(!this.spinActive||self.option.animation.isInfiniteDuration){if(this.spinActive=!1,cancelAnimationFrame(this.animationHandle),this.option.animation.isInfiniteDuration){var degree=this._getARandomLocationInASegment(this.option.winSegment);degree=this.option.spinDirection==this.spinDirection.clockwise?360-degree:degree,degree=this.option.spinDirection==this.spinDirection.clockwise?degree+this.option.pointer.degree:degree-this.option.pointer.degree,degree-=this.currentDrawAngle%360,this._drawRoulette(degree),this.currentDrawAngle=this.currentDrawAngle+degree}else this.currentDrawAngle=this.currentDrawAngle+this.currentRotation;this.onAnimationStop&&this.onAnimationStop(this.option.spinRewards[this.option.winSegment])}}_adjustStopRotationToWinSegment(_stopRotation){this.randomizeWin&&(this.option.winSegment=Math.floor(Math.random()*this.option.spinRewards.length));var winAngle=this._getARandomLocationInASegment(this.option.winSegment);console.log(winAngle);var adjustAntiClockwise=360-winAngle,winAngle,stopAngle=_stopRotation%360,diff;return stopAngle-=stopAngle-(winAngle=this.option.spinDirection==this.spinDirection.clockwise?adjustAntiClockwise:winAngle),stopAngle=this.option.spinDirection==this.spinDirection.clockwise?stopAngle+this.option.pointer.degree:stopAngle-this.option.pointer.degree,_stopRotation=360*Math.floor(_stopRotation/360)+stopAngle,_stopRotation-=this.currentDrawAngle%360}_getARandomLocationInASegment(segmentIndex){if(segmentIndex>=this.option.spinRewards.length)return 0;var i,segmentAngle=0;for(i=0;i<=segmentIndex;i++)segmentAngle+=this.option.spinRewards[i].degree;var plusOrMinus=1*Math.random()>.5?-1:1,randomLocationInSegment=Math.floor(Math.random()*(this.option.spinRewards[segmentIndex].degree/2)),segmentCentre,randomSegmentAngle;return segmentAngle-this.option.spinRewards[segmentIndex].degree/2+randomLocationInSegment*plusOrMinus}animate(){var diff=performance.now()-self.animationStartTimeInMilli,timeFraction=diff/self.option.animation.duration;if(timeFraction=(timeFraction=self.easeFunction(timeFraction))>1?1:timeFraction,self.currentRotation=self.stopRotation*timeFraction,self._drawRoulette(self.currentRotation%360),diff<self.option.animation.duration){if(self.prevTimFraction=timeFraction,self.option.animation.isInfiniteDuration){self.easeFunction=self._getEaseFunction("linear");var extendedDuration=1e3;self.option.animation.duration=self.option.animation.duration+1e3;var extendedRotation=self._getDurationRotation(1e3);self.stopRotation=self.stopRotation+extendedRotation}self.animationHandle=requestAnimationFrame(self.animate)}else self.spinActive=!1,self.stopAnimation()}_getEaseFunction(ease){switch(ease=ease.trim().toLowerCase()){case"easeIn":return this._arcCurve;case"easeout":return this._arcCurveEaseOut;case"easeinout":return this._arcCurveEaseInOut;default:return this._linear}}_linear(timeFraction){return timeFraction}_arcCurve(timeFraction){return 1-Math.sin(Math.acos(timeFraction))}_arcCurveEaseOut(timeFraction){return 1-this._arcCurve(1-timeFraction)}_arcCurveEaseInOut(timeFraction){return timeFraction<=.5?this._arcCurve(2*timeFraction)/2:(2-this._arcCurve(2*(1-timeFraction)))/2}_onTouchStart(e){e.preventDefault();var touch=e.touches[0]}_onTouchMove(e){e.preventDefault();var touch=e.touches[0];console.log(touch.pageX+" - "+touch.pageY)}_onTouchEnd(e){e.preventDefault();var touch=e.touches[0]}}